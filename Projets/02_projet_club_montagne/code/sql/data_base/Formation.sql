------------------------------------------- Formation : ------------------------------------------------------  

CREATE TABLE FORMATION (
   IdFORM INT,
   ANNEeFORM DATE,
   PRIMARY KEY (IdFORM, ANNEeFORM),
   NOM VARCHAR(50),
   DATeDEM DATE,
   DUREE INT,
   NBrPLACE INT,
   DescrFor VARCHAR(50),
   PRIX DECIMAL,
   NBrACTIVITE INT
);


INSERT INTO Formation VALUES (1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'FOR1',TO_DATE('2022-01-01', 'YYYY-MM-DD') , 20 , 30 ,'Bienvenue Dans For1' , 100 , 3 );
INSERT INTO Formation VALUES (2 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'FOR2',TO_DATE('2022-03-01', 'YYYY-MM-DD') , 10 , 50 ,'Bienvenue Dans For2' , 120 , 2 );
INSERT INTO Formation VALUES (3 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'FOR3',TO_DATE('2022-05-01', 'YYYY-MM-DD') , 30 , 70 ,'Bienvenue Dans For3' , 80 , 4 );



SELECT * FROM FORMATION ;

-- TABLE ACTIVITE : 

DROP  TABLE ACTIVITE ;

CREATE TABLE ACTIVITE (
   NOmACTIVITE VARCHAR(50) PRIMARY KEY 
);

INSERT INTO ACTIVITE VALUES ('AC1') ;
INSERT INTO ACTIVITE VALUES ('AC2') ;
INSERT INTO ACTIVITE VALUES ('AC3') ;
INSERT INTO ACTIVITE VALUES ('AC4') ;
INSERT INTO ACTIVITE VALUES ('AC5') ;
INSERT INTO ACTIVITE VALUES ('AC6') ;

SELECT * FROM Activite ; 


-- ProposeActivitéForm : 

CREATE TABLE PROPOSE_ACTIVITE_FORM 
(
   NUMERO INT,
   ANNEE  DATE ,
   NOmACTIVITE VARCHAR(50),
   FOREIGN KEY(NUMERO, ANNEE) REFERENCES FORMATION(IdFORM, ANNEeFORM),
   FOREIGN KEY (NOmACTIVITE) REFERENCES ACTIVITE(NomACTIVITE),
   PRIMARY KEY (NUMERO, ANNEE, NOmACTIVITE)

);

INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC1' ) ; 
INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC2' ) ; 
INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC4' ) ; 


INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(2 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC5' ) ; 
INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(2 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC2' ) ; 


INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(3 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC1' ) ; 
INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(3 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC6' ) ; 
INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(3 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC4' ) ; 
INSERT INTO PROPOSE_ACTIVITE_FORM VALUES(3 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ,'AC2' ) ; 


SELECT * FROM PROPOSE_ACTIVITE_FORM; 

-- réservation formation : 

DROP TABLE RESERVATION_FORMATION ; 

CREATE TABLE RESERVATION_FORMATION (
   IdReservFor INT PRIMARY KEY,
   RANG INT,
   IdUSER INT,
   NUMERO INT, 
   ANNEE DATE ,
   FOREIGN KEY (IdUSER) REFERENCES COMPTE_UTILISATEUR(IdUSER),
   FOREIGN KEY (NUMERO, ANNEE) REFERENCES FORMATION(IdFORM, ANNEeFORM)
);

INSERT INTO RESERVATION_FORMATION VALUES (1 ,1 ,5 , 1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ); 
INSERT INTO RESERVATION_FORMATION VALUES (2  ,2 ,6 , 1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ); 

INSERT INTO RESERVATION_FORMATION VALUES (3 ,1 ,6 , 2 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ); 
INSERT INTO RESERVATION_FORMATION VALUES (4 ,2 ,5 , 2 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ); 


SELECT * FROM RESERVATION_FORMATION ;



-- nombre de place dispo : 

-- Formation n=1 , annee=TO_DATE('2022-01-01', 'YYYY-MM-DD')



DROP VIEW NbrReservFor ;

CREATE VIEW NbrReservFor AS 
SELECT NUMERO , ANNEE , MAX(RANG) as nbMax
FROM RESERVATION_FORMATION
GROUP BY NUMERO ,ANNEE ;

SELECT * FROM NbrReservFor ;


DROP VIEW NBDISPOFOR ;
CREATE VIEW NBDISPOFOR AS 
SELECT Formation.IdFORM  , Formation.ANNEeFORM  , NBrPLACE - NbrReservFor.nbMax as  nbDispo  FROM NbrReservFor , Formation 
WHERE NbrReservFor.NUMERO = Formation.IdFORM 
AND NbrReservFor.ANNEE = Formation.ANNEeFORM ;

SELECT * FROM NBDISPOFOR ;


SELECT nbDispo FROM NBDISPOFOR WHERE IdFORM=1 AND ANNEeFORM= TO_DATE('2022-01-01','YYYY-MM-DD') ;



SELECT idUSER FROM ADHERENT;

INSERT INTO RESERVATION_FORMATION VALUES (1 ,1 ,5 , 1 ,TO_DATE('2022-01-01', 'YYYY-MM-DD') ); 


SELECT * FROM RESERVATION_FORMATION ;

SELECT COUNT(*) as count FROM RESERVATION_FORMATION;    

SELECT MAX(RANG) as max FROM RESERVATION_FORMATION WHERE NUMERO=2 AND ANNEE=TO_DATE('2022-01-01', 'YYYY-MM-DD');





